% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{run_mcmc}
\alias{run_mcmc}
\title{Run MCMC Algorithm for Estimation of Score Distribution Among Nodes of The
Tree}
\usage{
run_mcmc(
  patient_data,
  node_column,
  target_column,
  tree_depth,
  epochs,
  temperature = 1,
  n_results = 10L,
  cocktail_size = 2L,
  prob_type1 = 0.01,
  beta = 4L,
  max_score = 200,
  score_type = "hypergeometric",
  verbose = FALSE
)
}
\arguments{
\item{patient_data}{A data.frame containing patient information with at least
a node column and a target column.}

\item{node_column}{Either a string (column name) or integer (column index, 1-based)
specifying the column containing drug codes. This column should be either:
\itemize{
  \item A list of integer vectors: \code{list(c(1,2), c(3), c(4,5))}
  \item A character vector with comma-separated values: \code{c("1,2", "3", "4,5")}
}}

\item{target_column}{Either a string (column name) or integer (column index, 1-based)
specifying the target/outcome column. Integer values are treated as binary for now,
numeric values with non-0/1 entries are treated as continuous.}

\item{tree_depth}{An integer vector specifying the depth of each node in the
tree structure. Must start at depth 1 and children must be at depth+1 of
their parent.}

\item{epochs}{Number of MCMC iterations to run.}

\item{temperature}{Temperature parameter for the Metropolis-Hastings acceptance
probability. Higher values lead to an easiest acceptance of lower score. Default: 1.0.}

\item{n_results}{Number of top solutions to track and return. Default: 10.}

\item{cocktail_size}{Target size of drug combinations to search for. Default: 2.}

\item{prob_type1}{Probability of using Type 1 mutation (random generation) vs
Type 2 mutation (local swap). Default: 0.01.}

\item{beta}{Minimum number of patients that must be covered for a solution to
be included in the filtered results. Default: 4.}

\item{max_score}{Maximum score value for binning in the score distribution.
Scores above this are tracked separately. Default: 200.0.}

\item{score_type}{Scoring function to use. Either "hypergeometric" for the
hypergeometric test or "relative_risk" for relative risk calculation.
Default: "hypergeometric".}

\item{verbose}{If TRUE, prints progress and statistics during the run.
Default: FALSE.}
}
\value{
A list containing:
  \describe{
    \item{top_solutions}{List of node vectors for the top scoring solutions}
    \item{top_scores}{Numeric vector of scores for the top solutions}
    \item{top_solutions_filtered}{Top solutions meeting the beta threshold}
    \item{top_scores_filtered}{Scores for the filtered solutions}
    \item{score_distribution}{Histogram of scores (0.1-wide bins)}
    \item{score_distribution_filtered}{Histogram for solutions meeting beta threshold}
    \item{outstanding_scores}{Scores that exceeded max_score}
    \item{statistics}{List of run statistics including acceptance rates}
  }
}
\description{
Performs a Modified Metropolis-Hastings MCMC sampling to estimate the score
distribution of nodes combination of a given \emph{cocktail_size}. The
algorithm explores the space of tree combinations using a proposal law 
composed of two mutation types.
}
\details{
The MCMC algorithm uses a Modified Metropolis-Hastings approach with two
proposal types:
\itemize{
  \item \strong{Type 1}: Generates a completely new random valid solution
  \item \strong{Type 2}: Swaps one node with its parent or child in the tree
}

The acceptance probability for Type 1 proposal is:
\deqn{\alpha = \exp((S_{proposed} - S_{current}) / T)}

For Type 2 proposals, a proposal ratio correction is applied since the ratio
of \mathbb{P}(current | proposed) \noteq \mathbb{P}(proposed | current):
\deqn{\alpha = \exp((S_{proposed} - S_{current}) / T) \times \frac{|V_{current}|}{|V_{proposed}|}}

where \eqn{|V|} is the number of possible swap vertices for a solution.

Solutions are only accepted if they appear in at least one patient's data
("modified" constraint).
}
\examples{
\dontrun{
# Create example data
patient_df <- data.frame(
  patient_id = 1:100,
  outcome = rbinom(100, 1, 0.3)
)
patient_df$drugs <- lapply(1:100, function(i) sample(1:20, sample(1:5, 1)))

# Define tree structure (simple 3-level tree)
tree_depth <- c(1, rep(2, 5), rep(3, 15))

# Run MCMC
results <- run_mcmc(
  patient_data = patient_df,
  node_column = "drugs",
  target_column = "outcome",
  tree_depth = tree_depth,
  epochs = 5000,
  cocktail_size = 2,
  score_type = "hypergeometric",
  verbose = TRUE
)

# View top results
print(results$top_scores)
print(results$top_solutions)
}

}
